window.__tcfapi = function(command, version, callback, parameter) {
  var channelId='<%-CHANNEL_ID%>';
  var hasConsent = <%-TC_CONSENT%>;
  if (window.localStorage && localStorage.getItem) {
    var lc = localStorage.getItem('consent');
    if (lc === "true") hasConsent = true;
    if (lc === "false") hasConsent = false;
  }
  var _listenerCnt = 1;
  var _listeners = {};
  switch (command) {
    case 'ping':
      callback({
        gdprApplies: true,
        cmpLoaded: true,
        cmpStatus: 'loaded',
        displayStatus: 'hidden',
        apiVersion: '2.0',
        cmpVersion: 1,
        cmpId: 4040,
        gvlVersion: 1,
        tcfPolicyVersion: 2
      });
      break;
    case 'getTCData':
      callback({
        tcString: '<%-TC_STRING%>',
        tcfPolicyVersion: 2,
        cmpId: 4040,
        cmpVersion: 1,
        gdprApplies: true,
        eventStatus: 'tcloaded',
        cmpStatus: '<%-CMP_STATUS%>',
        listenerId: undefined,
        isServiceSpecific: true,
        useNonStandardStacks: false,
        publisherCC: 'AT',
        purposeOneTreatment: true,
        purpose: {
          consents: {
            1: true,
            7: true,
            8: true
          }
        },
        legitimateInterests: {
          consents: {
            1: true,
            7: true,
            8: true
          }
        },
        vendor: {
          consents: {
            4040: hasConsent,
          }
        }
      }, true);
      break;
    case 'addEventListener':
      _listeners[_listenerCnt] = callback;
      break;
    case 'removeEventListener':
      var listener = _listeners[parameter];
      if (!listener) {
        setTimeout(function() {
          callback(false);
        }, 1);
        return;
      }
      setTimeout(function () {
        callback(true);
      }, 1);
      break;
    case 'setConsent':
      var i = document.createElement('img');
      i.src = '<%-URL_SCHEME%>://<%-CONSENT_SERVER_HOST%>/set-consent?consent=' + (String(parameter) === "true" ? 1 : 0) + (channelId !== '' ? '&channelId=' + channelId : '');
      callback(parameter);
      if (window.localStorage && localStorage.setItem) {
        localStorage.setItem('consent', parameter);
      }
      break;
    <%-BANNER_NO_IFRAME%>
    default:
      break;
    }
};
